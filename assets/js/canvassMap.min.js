var canvassMap={map:null,center:[41.478039,-90.529118],api_key:canvass_settings.api_key,nonMarker:null,onMarker:null,mode:"view",load:function(){canvassMap.nonMarker=L.icon({iconUrl:"/wp-content/plugins/canvass/assets/img/non.png",iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[2,2]}),canvassMap.onMarker=L.icon({iconUrl:"/wp-content/plugins/canvass/assets/img/on.png",iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[2,2]}),canvassMap.map=L.map("map").setView(canvassMap.center,15),L.tileLayer.bing({bingMapsKey:bing_canvass_params.bing_api_key,imagerySet:"AerialWithLabels"}).addTo(canvassMap.map),canvassMap.placeExistingMarkers(),canvassMap.map.on("click",canvassMap.mapClick),L.control.custom({position:"topright",content:'<button type="button" class="btn btn-primary canvass-view-mode canvass-mode-button">    <i class="fa fa-eye"></i></button><button type="button" class="btn btn-primary canvass-add-mode canvass-mode-button">    <i class="fa fa-plus-square"></i></button><button type="button" class="btn btn-primary canvass-delete-mode canvass-mode-button">    <i class="fa fa-trash"></i></button>',classes:"btn-group-vertical btn-group-sm",style:{margin:"10px",padding:"0px 0 0 0",cursor:"pointer"},datas:{foo:"bar"},events:{click:function(n){var e=n.target;"i"==e.tagName.toLowerCase()&&(e=e.parentNode);var a="view",t=e.classList;t.contains("canvass-add-mode")?a="add":t.contains("canvass-delete-mode")&&(a="delete"),canvassMap.changeMode(a,e)}}}).addTo(canvassMap.map),canvassMap.changeMode("view",document.querySelector(".canvass-view-mode"))},placeExistingMarkers(){var n=new L.LatLngBounds;canvass_settings.existing_markers.forEach(function(e){var a=L.marker([e.latitude,e.longitude],{icon:canvassMap.nonMarker});a.bindPopup(e.fullAddress),a.addTo(canvassMap.map),a.on("click",function(){"add"==canvassMap.mode&&canvassMap.markerConvert(a),"delete"==canvassMap.mode&&canvassMap.markerDelete(a)}),n.extend(a.getLatLng())}),canvass_settings.existing_markers.length>0&&canvassMap.map.fitBounds(n)},changeMode(n,e){console.log("Changing map mode",n),canvassMap.map.closePopup();document.querySelectorAll(".canvass-mode-button").forEach(function(n){n.classList.add("btn-primary"),n.classList.remove("btn-default")});e.classList.add("btn-default"),e.classList.remove("btn-primary"),canvassMap.mode=n},mapClick:function(n){"view"!=canvassMap.mode?"add"!=canvassMap.mode?canvassMap.mode:canvassMap.mapClickAdd(n):canvassMap.mapClickView(n)},mapClickView:function(n){},mapClickAdd:function(n){canvassMap.markerPlace(n.latlng),canvassMap.markerStore(n.latlng,"add")},mapClickDelete:function(n){canvassMap.markerDelete(n.latlng)},markerPlace(n){var e=L.marker(n,{icon:canvassMap.onMarker});return e.addTo(canvassMap.map),e},markerDelete(n){canvassMap.map.removeLayer(n),canvassMap.markerStore(n._latlng,"remove")},markerConvert:n=>(canvassMap.markerStore(n._latlng,"add"),n.setIcon(canvassMap.onMarker),n),markerStore(n,e){var a="Storing new location";"remove"==e&&(a="Removing existing location"),console.log(a,n);var t=canvass_settings.ajax_url;t+="?action="+canvass_settings.storage_action,t+="&latitude="+n.lat,t+="&longitude="+n.lng,t+="&mode="+e;var p=new Request(t,{method:"GET"});fetch(p).then(n=>n.text()).then(n=>console.log(n)).catch(n=>console.error(n))}};window.onload=function(){canvassMap.load()};